import{a as h}from"./chunk-SQL4RJQR.js";import{a as c,b as o,c as S,d as l}from"./chunk-XV66CBGI.js";import{a as s,b as n}from"./chunk-JHI3MBHO.js";var T=(()=>{let i=class i{constructor(t){this.storage=t,this.timerState=new c({isRunning:!1,isPaused:!1,timeRemaining:0,totalTime:0,currentType:null,sessionNumber:1,completedSessions:0}),this.timerState$=this.timerState.asObservable()}startTimer(t,e){this.stopTimer();let r=e*60;this.currentSessionId=this.generateId(),this.sessionStartTime=new Date,this.timerState.next(n(s({},this.timerState.value),{isRunning:!0,isPaused:!1,timeRemaining:r,totalTime:r,currentType:t})),this.timerSubscription=o(1e3).subscribe(()=>{let m=this.timerState.value,u=m.timeRemaining-1;u<=0?this.completeSession():this.timerState.next(n(s({},m),{timeRemaining:u}))})}pauseTimer(){this.timerSubscription&&!this.timerState.value.isPaused&&(this.timerSubscription.unsubscribe(),this.timerState.next(n(s({},this.timerState.value),{isPaused:!0,isRunning:!1})))}resumeTimer(){this.timerState.value.isPaused&&(this.timerState.next(n(s({},this.timerState.value),{isPaused:!1,isRunning:!0})),this.timerSubscription=o(1e3).subscribe(()=>{let t=this.timerState.value,e=t.timeRemaining-1;e<=0?this.completeSession():this.timerState.next(n(s({},t),{timeRemaining:e}))}))}stopTimer(){this.timerSubscription&&this.timerSubscription.unsubscribe(),this.timerState.next({isRunning:!1,isPaused:!1,timeRemaining:0,totalTime:0,currentType:null,sessionNumber:this.timerState.value.sessionNumber,completedSessions:this.timerState.value.completedSessions}),this.currentSessionId=void 0,this.sessionStartTime=void 0}restartTimer(){let t=this.timerState.value;if(t.currentType){let e=Math.floor(t.totalTime/60);this.startTimer(t.currentType,e)}}completeSession(){this.timerSubscription&&this.timerSubscription.unsubscribe();let t=this.timerState.value;if(this.currentSessionId&&this.sessionStartTime&&t.currentType){let r={id:this.currentSessionId,date:this.sessionStartTime,startTime:this.formatTime(this.sessionStartTime),duration:Math.floor(t.totalTime/60),type:t.currentType,completed:!0};this.storage.addSession(r)}let e=t.completedSessions+1;this.timerState.next({isRunning:!1,isPaused:!1,timeRemaining:0,totalTime:0,currentType:null,sessionNumber:t.sessionNumber,completedSessions:e}),this.currentSessionId=void 0,this.sessionStartTime=void 0}resetSessionCount(){this.timerState.next(n(s({},this.timerState.value),{sessionNumber:1,completedSessions:0}))}getProgress(){let t=this.timerState.value;return t.totalTime===0?0:(t.totalTime-t.timeRemaining)/t.totalTime*100}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}formatTime(t){let e=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0");return`${e}:${r}`}};i.\u0275fac=function(e){return new(e||i)(l(h))},i.\u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();export{T as a};
